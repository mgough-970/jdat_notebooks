
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Photometry of a JWST/NIRCam extragalactic field with Photutils &#8212; STScI JDAT Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css?v=b44a18d9" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-D46G4HKJY3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-D46G4HKJY3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/cross_instrument/photometry_extragalactic/photutils';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="STScI JDAT Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="STScI JDAT Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">General</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebook_development_workflow.html">Notebook Development Workflow</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/submitting_notebooks.html">Submitting Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/requirements.html">Requirements file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebooks.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/data_files.html">Data Files</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">GitHub Guidelines</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_setup.html">GitHub Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_workflow.html">GitHub Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_pr.html">GitHub PR</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Cross-Instrument</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../asdf_example/asdf_example.html">ASDF Example</a></li>

<li class="toctree-l1"><a class="reference internal" href="../background_estimation_imaging/Imaging_Sky_Background_Estimation.html">Complex 2D Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../composite_model_fitting/specfit_demo_3.html">Composite Model Spectral Fitting</a></li>


<li class="toctree-l1"><a class="reference internal" href="../rgb_imviz/imviz_rgb_carina.html">RGB images with Imviz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">Specviz Simple Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../update_pure_parallel_wcs/NIRISS_correct_pure_parallel_WCS.html">Improving Accuracy of WCS of Pure Parallel Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stpsf_examples/stpsf_examples.html">STPSF Examples</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MIRI</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">MRS Mstar - Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">IFU of YSOs in LMC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/MIRI_LRS_spectral_extraction/miri_lrs_advanced_extraction_part1.html">LRS Optimal Spectral Extraction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRCam</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/aperture_photometry/NIRCam_Aperture_Photometry_Example.html">Point Source Aperture Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_photometry/NIRCam_multiband_photometry.html">Extended Aperture Photometry</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">Cross-Filter PSF Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/psf_photometry/NIRCam_PSF_Photometry_Example.html">PSF Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_wisp_subtraction/nircam_wisp_subtraction.html">NIRCam Wisp Removal</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRISS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/00_Optimal_extraction.html">WFSS Spectra - Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/01_Combine_and_normalize_1D_spectra.html">WFSS Spectra - Combine and Normalize 1D Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/02_Cross_correlation_template.html">WFSS Spectra - Cross-Correlation Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map.html">WFSS Spectra - Emission Line Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/00_niriss_mast_query_data_setup.html">NIRISS MAST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/01_niriss_wfss_image2_image3.html">Direct imaging for WFSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/02_niriss_wfss_spec2.html">Spec2 pipeline for WFSS</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRSpec</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html">IFU Cube Fitting</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/cube_fitting/cube_fitting.html">IFU Cube Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/ifu_optimal/ifu_optimal.html">IFU Optimal Spectral Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/optimal_extraction/Spectral_Extraction-static.html">MOS Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/mos_spectroscopy_advanced/MOSspec_advanced.html">MOS Spectroscopy of Extragalactic Field</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">BOTS Time Series Observations</a></li>








<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/galaxy_redshift/redshift_fitting.html">Redshift and Template Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/FS_NSClean_example.html">FS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/IFU_NSClean_example.html">IFU Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/MOS_NSClean_example.html">MOS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/BOTS_NSClean_example.html">BOTS Products with NSClean</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/cross_instrument/photometry_extragalactic/photutils.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/cross_instrument/photometry_extragalactic/photutils.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Photometry of a JWST/NIRCam extragalactic field with Photutils</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Photometry of a JWST/NIRCam extragalactic field with Photutils</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tutorial-overview">Tutorial Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outline">Outline:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">Import packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-datasets">Load Datasets</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-overview">Data Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-units">Data Units</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-and-display-the-data">Load and Display the Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background-subtraction">Background Subtraction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d-background-estimation">2D Background Estimation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#source-mask">Source Mask</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#background2d">Background2D</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aperture-photometry">Aperture Photometry</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-an-aperture-object">Define an Aperture Object</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aperture-photometry-function">aperture_photometry function</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-positions-and-sizes">Multiple positions and sizes</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aperturestats-class">ApertureStats class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sky-based-apertures">Sky-based apertures</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-multiband-segmentation-based-catalog">Creating a multiband segmentation-based catalog</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-detection-image">Creating a Detection Image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#image-segmentation-source-extraction">Image Segmentation (Source Extraction)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#source-deblending">Source deblending</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modifying-a-segmentation-image">Modifying a Segmentation Image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sourcefinder-class">SourceFinder class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#source-catalog-photometry-centroids-and-shape-properties">Source Catalog: Photometry, Centroids, and Shape Properties</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiband-catalog">Multiband Catalog</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#photometry-types">Photometry types</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#segment-fluxes-aka-isophotal-fluxes">Segment fluxes (aka “Isophotal Fluxes”)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Aperture Photometry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kron-photometry">Kron Photometry</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-exploration">Data Exploration</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="title" src="https://github.com/STScI-MIRI/MRS-ExampleNB/raw/main/assets/banner1.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="photometry-of-a-jwst-nircam-extragalactic-field-with-photutils">
<h1>Photometry of a JWST/NIRCam extragalactic field with Photutils<a class="headerlink" href="#photometry-of-a-jwst-nircam-extragalactic-field-with-photutils" title="Link to this heading">#</a></h1>
<p>Author: Larry Bradley, Space Telescope Science Institute<br>
Data last modified: 2025-02-27</p>
<section id="tutorial-overview">
<h2>Tutorial Overview<a class="headerlink" href="#tutorial-overview" title="Link to this heading">#</a></h2>
<p>This tutorial will demonstrate how to use <a class="reference external" href="https://photutils.readthedocs.io/">Photutils</a> to perform multiband NIRCam photometry on an extragalactic field.</p>
<p>Photutils is a Python library that provides commonly-used tools and key functionality for detecting and performing photometry of astronomical sources. Tools are provided for</p>
<ul class="simple">
<li><p>background estimation</p></li>
<li><p>star finding</p></li>
<li><p>source detection and extraction</p></li>
<li><p>aperture photometry</p></li>
<li><p>PSF photometry</p></li>
<li><p>image segmentation</p></li>
<li><p>centroids</p></li>
<li><p>radial profiles</p></li>
<li><p>elliptical isophote fitting</p></li>
</ul>
<p>It is a coordinated package of <a class="reference external" href="https://docs.astropy.org/en/stable/">Astropy</a> and integrates well with other Astropy packages, making it a powerful tool for astronomical image analysis.</p>
</section>
<section id="outline">
<h2>Outline:<a class="headerlink" href="#outline" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Load Datasets</p></li>
<li><p>Background Subtraction</p></li>
<li><p>Aperture Photometry</p></li>
<li><p>Creating a multiband segmentation-based catalog</p>
<ol class="arabic simple">
<li><p>Creating a Detection Image</p></li>
<li><p>Source Extraction via Image Segmentation</p></li>
<li><p>Source Deblending</p></li>
<li><p>Modifying a Segmentation Image</p></li>
<li><p>SourceFinder convenience class</p></li>
<li><p>Source Measurements: Source Catalog</p></li>
<li><p>Creating a Multiband Catalog</p></li>
<li><p>Catalog Exploration</p></li>
</ol>
</li>
</ol>
</section>
<section id="import-packages">
<h2>Import packages<a class="headerlink" href="#import-packages" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.mast</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">u</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.convolution</span><span class="w"> </span><span class="kn">import</span> <span class="n">convolve</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">hstack</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.visualization</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleNorm</span><span class="p">,</span> <span class="n">simple_norm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.wcs</span><span class="w"> </span><span class="kn">import</span> <span class="n">WCS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">photutils.aperture</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">ApertureStats</span><span class="p">,</span> <span class="n">CircularAperture</span><span class="p">,</span>
                                <span class="n">SkyCircularAperture</span><span class="p">,</span> <span class="n">aperture_photometry</span><span class="p">,</span> 
                                <span class="n">aperture_to_region</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">photutils.background</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">Background2D</span><span class="p">,</span> <span class="n">BiweightLocationBackground</span><span class="p">,</span>
                                  <span class="n">BiweightScaleBackgroundRMS</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">photutils.segmentation</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">SourceCatalog</span><span class="p">,</span>
                                    <span class="n">deblend_sources</span><span class="p">,</span> <span class="n">detect_sources</span><span class="p">,</span>
                                    <span class="n">make_2dgaussian_kernel</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">photutils.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">CutoutImage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">regions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Regions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">grey_dilation</span>

<span class="c1"># Change some default plotting parameters</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.constrained_layout.use&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.max_open_warning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.interpolation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;nearest&#39;</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lower&#39;</span>

<span class="c1"># Enable interactive plots</span>
<span class="c1"># %matplotlib ipympl</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">download_files</span><span class="p">(</span><span class="n">files_to_download</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download a list of files from MAST.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    files_to_download : list</span>
<span class="sd">        List of filenames</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files_to_download</span><span class="p">:</span>
        <span class="c1"># Check if the file already exists in the current working directory</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> already exists. Skipping download.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">cal_uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;mast:HLSP/ceers/nircam/</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">.gz&#39;</span>
        <span class="n">Observations</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">cal_uri</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gunzip&#39;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="s1">&#39;.gz&#39;</span><span class="p">]</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-datasets">
<h2>Load Datasets<a class="headerlink" href="#load-datasets" title="Link to this heading">#</a></h2>
<section id="data-overview">
<h3>Data Overview<a class="headerlink" href="#data-overview" title="Link to this heading">#</a></h3>
<p>We will use 3 JWST/NIRCam images in the F115W, F200W, and F356W filters from the <a class="reference external" href="https://ceers.github.io/">Cosmic Evolution Early Release Science Survey (CEERS)</a> survey.</p>
<p>These are fully-calibration High-level Science Products (HLSPs) produced by the CEERS team of their <a class="reference external" href="https://ceers.github.io/dr05.html">NIRCam 2 pointing</a> within the Extended Groth Strip (EGS) HST legacy field. The full CEERS data includes 7 NIRCam filters (F115W, F150W, F200W, F277W, F356W, F410M, F444W) plus MIRI and NIRSpec data. The NIRCam data were taken in parallel to prime NIRSpec observations.</p>
<p>The images are pixel aligned and have a pixel scale of 30 mas/pixel.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn1</span> <span class="o">=</span> <span class="s1">&#39;hlsp_ceers_jwst_nircam_nircam2_f115w_v0.5_i2d.fits&#39;</span>
<span class="n">fn2</span> <span class="o">=</span> <span class="s1">&#39;hlsp_ceers_jwst_nircam_nircam2_f200w_v0.5_i2d.fits&#39;</span>
<span class="n">fn3</span> <span class="o">=</span> <span class="s1">&#39;hlsp_ceers_jwst_nircam_nircam2_f356w_v0.5_i2d.fits&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download_files</span><span class="p">([</span><span class="n">fn1</span><span class="p">,</span> <span class="n">fn2</span><span class="p">,</span> <span class="n">fn3</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s see what’s in these files using the <code class="docutils literal notranslate"><span class="pre">fits.info()</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fits</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">fn1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note that these files have extra extensions that are not in the pipeline-produced <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/jwst/data_products/science_products.html#resampled-2-d-data-i2d-and-s2d">i2d files</a> (e.g., SCI_BKSUB, BKGD, BKGMASK)</p>
<p>Let’s load the NIRCam F115W image and display it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">fn1</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">snorm</span> <span class="o">=</span> <span class="n">SimpleNorm</span><span class="p">(</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">98</span><span class="p">)</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">snorm</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>There are 2 NIRCam modules (A &amp; B), each with <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-near-infrared-camera/nircam-observing-modes/nircam-imaging#gsc.tab=0">4 NIRCam short-wavelength (SW) detectors</a>.  All 8 SW detectors are 2k x 2k. There are also 2 2k x 2k long wavelength detectors, one covering each module. We see the SW detector gaps in each NIRCam module because these were parallel observations to NIRSpec prime observations. The prime observations had only very small dithers.</p>
</section>
<section id="data-units">
<h3>Data Units<a class="headerlink" href="#data-units" title="Link to this heading">#</a></h3>
<p>The JWST calibration pipeline produces images in units of MJy/sr. The unit is stored in the FITS header in the <code class="docutils literal notranslate"><span class="pre">BUNIT</span></code> key.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">header</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">fn1</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">header</span><span class="p">[</span><span class="s1">&#39;BUNIT&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;BUNIT&#39;</span><span class="p">])</span>
<span class="n">data_unit</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># another way to create the unit</span>
<span class="n">u</span><span class="o">.</span><span class="n">MJy</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span>
</pre></div>
</div>
</div>
</div>
<p>The pixel area in steradians is stored in the FITS header in the <code class="docutils literal notranslate"><span class="pre">PIXAR_SR</span></code> key.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;PIXAR_SR&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s use Astropy units to calculate a scale factor to convert our original data in units of MJy/sr to μJy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">uJy</span>
<span class="n">unit_conv</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="n">data_unit</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;PIXAR_SR&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<span class="n">unit_conv</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-and-display-the-data">
<h3>Load and Display the Data<a class="headerlink" href="#load-and-display-the-data" title="Link to this heading">#</a></h3>
<p>Let’s load the data. We’ll use only one of the NIRCam modules. We’ll also convert the units from MJy/sr to μJy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define a tuple of slice objects to extract only 1 NIRCam module</span>
<span class="n">slc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1650</span><span class="p">,</span> <span class="mi">6450</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4700</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">slc</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sci&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">slc</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">slc</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_rnoise&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">slc</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;wcs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)[</span><span class="n">slc</span><span class="p">]</span>

        <span class="c1"># convert the units in-place</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">unit_conv</span><span class="o">.</span><span class="n">value</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;=</span> <span class="n">unit_conv</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sci&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">unit_conv</span><span class="o">.</span><span class="n">value</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sci&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;=</span> <span class="n">unit_conv</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">unit_conv</span><span class="o">.</span><span class="n">value</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;=</span> <span class="n">unit_conv</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_rnoise&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">unit_conv</span><span class="o">.</span><span class="n">value</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_rnoise&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;=</span> <span class="n">unit_conv</span><span class="o">.</span><span class="n">unit</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="n">f115w</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="n">fn1</span><span class="p">)</span>
<span class="n">f200w</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="n">fn2</span><span class="p">)</span>
<span class="n">f356w</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="n">fn3</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">f115w</span><span class="p">,</span> <span class="n">f200w</span><span class="p">,</span> <span class="n">f356w</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s display the images.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">snorm</span> <span class="o">=</span> <span class="n">SimpleNorm</span><span class="p">(</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">98</span><span class="p">)</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">snorm</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;sci&#39;</span><span class="p">])</span>

<span class="n">nimg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="n">nimg</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nimg</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;sci&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="background-subtraction">
<h2>Background Subtraction<a class="headerlink" href="#background-subtraction" title="Link to this heading">#</a></h2>
<p>Let’s plot the histograms of the pixel values near zero to see if there is any background pedestal.</p>
<p>The CEERS team already subtracted a constant background value from each image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nimg</span><span class="p">):</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;sci&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">vals</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="d-background-estimation">
<h3>2D Background Estimation<a class="headerlink" href="#d-background-estimation" title="Link to this heading">#</a></h3>
<p>To remove the varying residual background, we can use the <code class="docutils literal notranslate"><span class="pre">photutils</span></code> <a class="reference external" href="https://photutils.readthedocs.io/en/stable/api/photutils.background.Background2D.html">Background2D</a> class.</p>
<p>This class can be used to estimate a 2D background and background RMS noise in an image.</p>
<p>The background is estimated using (sigma-clipped) statistics in each box of a grid that covers the input data to create a low-resolution background map.</p>
<p>The final background map is calculated by interpolating the low-resolution background map.</p>
<section id="source-mask">
<h4>Source Mask<a class="headerlink" href="#source-mask" title="Link to this heading">#</a></h4>
<p>To get the best possible background estimate, we need to first create a mask of the sources in the image.</p>
<p>Let’s create a very rough source mask using a single threshold value. Here, we dilate the mask using a 45x45 pixel square footprint to include source wings in the mask.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">f115w</span><span class="p">[</span><span class="s1">&#39;sci&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mf">0.001</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="background2d">
<h4>Background2D<a class="headerlink" href="#background2d" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_estimator</span> <span class="o">=</span> <span class="n">BiweightLocationBackground</span><span class="p">()</span>
<span class="n">bkgrms_estimator</span> <span class="o">=</span> <span class="n">BiweightScaleBackgroundRMS</span><span class="p">()</span>
<span class="n">coverage_mask</span> <span class="o">=</span> <span class="n">f115w</span><span class="p">[</span><span class="s1">&#39;sci&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">bkg</span> <span class="o">=</span> <span class="n">Background2D</span><span class="p">(</span><span class="n">f115w</span><span class="p">[</span><span class="s1">&#39;sci&#39;</span><span class="p">],</span> <span class="n">box_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">filter_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">exclude_percentile</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                   <span class="n">bkg_estimator</span><span class="o">=</span><span class="n">bkg_estimator</span><span class="p">,</span> <span class="n">bkgrms_estimator</span><span class="o">=</span><span class="n">bkgrms_estimator</span><span class="p">,</span>
                   <span class="n">coverage_mask</span><span class="o">=</span><span class="n">coverage_mask</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
<span class="n">bkgim</span> <span class="o">=</span> <span class="n">bkg</span><span class="o">.</span><span class="n">background</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f115w</span><span class="p">[</span><span class="s1">&#39;sci&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F115W Original&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bkgim</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F115W Background&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">f115w</span><span class="p">[</span><span class="s1">&#39;sci&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bkgim</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F115W Background Subtracted&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f115w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F115W CEERS Background Subtracted&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fits</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">fn1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s load the CEERS source mask and show a comparison.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ceers_bkgmask</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">fn1</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">10</span><span class="p">)[</span><span class="n">slc</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simple Source Mask&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ceers_bkgmask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span> <span class="o">^</span> <span class="n">coverage_mask</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;CEERS Source Mask&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s compute the background again, but this time we’ll use the CEERS source mask.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg</span> <span class="o">=</span> <span class="n">Background2D</span><span class="p">(</span><span class="n">f115w</span><span class="p">[</span><span class="s1">&#39;sci&#39;</span><span class="p">],</span> <span class="n">box_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">filter_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                   <span class="n">exclude_percentile</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">coverage_mask</span><span class="o">=</span><span class="n">coverage_mask</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">ceers_bkgmask</span><span class="p">,</span>
                   <span class="n">bkg_estimator</span><span class="o">=</span><span class="n">bkg_estimator</span><span class="p">,</span> <span class="n">bkgrms_estimator</span><span class="o">=</span><span class="n">bkgrms_estimator</span><span class="p">)</span>
<span class="n">bkgim</span> <span class="o">=</span> <span class="n">bkg</span><span class="o">.</span><span class="n">background</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f115w</span><span class="p">[</span><span class="s1">&#39;sci&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F115W Original&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bkgim</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F115W Background&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">f115w</span><span class="p">[</span><span class="s1">&#39;sci&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bkgim</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F115W Background Subtracted&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f115w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F115W CEERS Background Subtracted&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>See the <a class="reference external" href="https://github.com/ceers/ceers-nircam">CEERS NIRCam GitHub repository</a> for the scripts used for making the source mask and performing background subtraction.</p>
<p>We’ll use the CEERS background-subtracted (<code class="docutils literal notranslate"><span class="pre">SCI_BKSUB</span></code>) images for the rest of this tutorial.</p>
</section>
</section>
</section>
<section id="aperture-photometry">
<h2>Aperture Photometry<a class="headerlink" href="#aperture-photometry" title="Link to this heading">#</a></h2>
<p>Photutils provides circular, elliptical, and rectangular aperture shapes (plus annulus versions of each).</p>
<p>Further, there are two types of aperture classes, defined either with pixel or sky (celestial) coordinates.</p>
<p>These are the names of the <a class="reference external" href="https://photutils.readthedocs.io/en/stable/user_guide/aperture.html#apertures">aperture classes</a> that are defined in pixel coordinates:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CircularAperture</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CircularAnnulus</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EllipticalAperture</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EllipticalAnnulus</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RectangularAperture</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RectangularAnnulus</span></code></p></li>
</ul>
<p>The aperture classes defined in celestial coordinates have <code class="docutils literal notranslate"><span class="pre">Sky</span></code> prepended to their names:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SkyCircularAperture</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SkyCircularAnnulus</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SkyEllipticalAperture</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SkyEllipticalAnnulus</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SkyRectangularAperture</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SkyRectangularAnnulus</span></code></p></li>
</ul>
<section id="define-an-aperture-object">
<h3>Define an Aperture Object<a class="headerlink" href="#define-an-aperture-object" title="Link to this heading">#</a></h3>
<p>First, let’s define a circular aperture at the two given (x, y) pixel positions and radius (in pixels).</p>
<p>Photutils has many tools for detecting sources (e.g., see <a class="reference external" href="https://photutils.readthedocs.io/en/stable/user_guide/detection.html">photutils.detection</a> and <a class="reference external" href="https://photutils.readthedocs.io/en/stable/user_guide/segmentation.html">photutils.segmentation</a>) and measuring source positions (e.g., <a class="reference external" href="https://photutils.readthedocs.io/en/stable/user_guide/centroids.html">photutils.centroids</a>). For this example, we’ll use estimated values based on cursor positions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xypos</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1262.9</span><span class="p">,</span> <span class="mf">2781.4</span><span class="p">),</span> <span class="p">(</span><span class="mf">1285.9</span><span class="p">,</span> <span class="mf">2939.3</span><span class="p">)]</span>
<span class="n">aper</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">(</span><span class="n">xypos</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">aper</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f115w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">aper</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">1400</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">2700</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="aperture-photometry-function">
<h3>aperture_photometry function<a class="headerlink" href="#aperture-photometry-function" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phot</span> <span class="o">=</span> <span class="n">aperture_photometry</span><span class="p">(</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">],</span> <span class="n">aper</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">],</span> <span class="n">wcs</span><span class="o">=</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;wcs&#39;</span><span class="p">])</span>
<span class="n">phot</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phot</span><span class="p">[</span><span class="s1">&#39;aperture_mag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;aperture_sum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ABmag</span><span class="p">)</span>
<span class="n">phot</span>
</pre></div>
</div>
</div>
</div>
<section id="multiple-positions-and-sizes">
<h4>Multiple positions and sizes<a class="headerlink" href="#multiple-positions-and-sizes" title="Link to this heading">#</a></h4>
<p>Multiple aperture objects can be input, <strong>BUT</strong> they must all have identical positions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aper2</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">(</span><span class="n">xypos</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">aperture_photometry</span><span class="p">(</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">aper</span><span class="p">,</span> <span class="n">aper2</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">],</span> <span class="n">wcs</span><span class="o">=</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;wcs&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="aperturestats-class">
<h3>ApertureStats class<a class="headerlink" href="#aperturestats-class" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ApertureStats</span></code> calculates various statistics (including the sum) and properties using the pixels within the aperture.</p>
<p>Only one aperture object can be input.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">apstats</span> <span class="o">=</span> <span class="n">ApertureStats</span><span class="p">(</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">],</span> <span class="n">aper</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">],</span> <span class="n">wcs</span><span class="o">=</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;wcs&#39;</span><span class="p">])</span>
<span class="n">apstats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats_tbl</span> <span class="o">=</span> <span class="n">apstats</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span>
<span class="n">stats_tbl</span>
</pre></div>
</div>
</div>
</div>
<p>The aperture statistics can also be accessed as attributes, e.g.,:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">apstats</span><span class="o">.</span><span class="n">mean</span>
</pre></div>
</div>
</div>
</div>
<p>Note that the returned measurements are for the input aperture position. <code class="docutils literal notranslate"><span class="pre">ApertureStats</span></code> returns the centroid value of the pixels within the input aperture, but the aperture is <strong>not</strong> recentered at the measured centroid position. However, you can create a new Aperture object using the measured centroid and then re-run <code class="docutils literal notranslate"><span class="pre">ApertureStats</span></code>.</p>
</section>
<section id="sky-based-apertures">
<h3>Sky-based apertures<a class="headerlink" href="#sky-based-apertures" title="Link to this heading">#</a></h3>
<p>Sky-based apertures require an Astropy
<a class="reference external" href="https://docs.astropy.org/en/stable/coordinates/index.html">SkyCoord</a>
position and a size as an Astropy <a class="reference external" href="https://docs.astropy.org/en/stable/units/index.html">Quantity</a>
in angular units.</p>
<p>Sky apertures are not defined completely in sky coordinates. They simply use sky coordinates to define the central position, and the remaining parameters are converted to pixels using the pixel scale of the image at the central position. Projection distortions are not taken into account. They are not defined as apertures on the celestial sphere, but rather are meant to represent aperture shapes on an image. If the apertures were defined completely in sky coordinates, their shapes would not be preserved when converting to or from pixel coordinates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xypos</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1262.9</span><span class="p">,</span> <span class="mf">2781.4</span><span class="p">),</span> <span class="p">(</span><span class="mf">1285.9</span><span class="p">,</span> <span class="mf">2939.3</span><span class="p">)]</span>
<span class="n">skycoord</span> <span class="o">=</span> <span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;wcs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pixel_to_world</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">xypos</span><span class="p">))</span>
<span class="n">skycoord</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sky_aper</span> <span class="o">=</span> <span class="n">SkyCircularAperture</span><span class="p">(</span><span class="n">skycoord</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">)</span>
<span class="n">sky_aper</span>
</pre></div>
</div>
</div>
</div>
<p>When performing aperture photometry with a Sky-based aperture, a WCS transformation must be input.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phot</span> <span class="o">=</span> <span class="n">aperture_photometry</span><span class="p">(</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">],</span> <span class="n">sky_aper</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">],</span> <span class="n">wcs</span><span class="o">=</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;wcs&#39;</span><span class="p">])</span>
<span class="n">phot</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="creating-a-multiband-segmentation-based-catalog">
<h1>Creating a multiband segmentation-based catalog<a class="headerlink" href="#creating-a-multiband-segmentation-based-catalog" title="Link to this heading">#</a></h1>
<section id="creating-a-detection-image">
<h2>Creating a Detection Image<a class="headerlink" href="#creating-a-detection-image" title="Link to this heading">#</a></h2>
<p>We are ready to detect sources in our multiband data, but which image do we use? Typically, that depends on your science use case. For example, perhaps you are interested in Lyman-break dropout galaxies, in which case a redder filter or filters is more appropriate.</p>
<p>One other consideration is the varying PSF across our multiband data where the PSF is broader at redder-wavelengths (R ~ λ / D). One method to address this is to PSF match all the multiband data to a common PSF (usually the reddest band with the broadest PSF). A common technique is to generate a set of matching kernels that are then convolved with the images, blurring them all to the same resolution as the reddest band. See <a class="reference external" href="https://photutils.readthedocs.io/en/latest/user_guide/psf_matching.html">Photutils PSF Matching</a> for tools to create matching kernels. We do not PSF match our multiband data in the examples that follow.</p>
<p>In general, one should use a detection image with a high signal-to-noise ratio. A common case is to create a deep detection image by combining the images in several filters. We can do this by creating an inverse-variance weighted combination of images. For this example, we’ll use all three filter images. The weights will be the inverse variance of the read noise (the read noise variance is in the <code class="docutils literal notranslate"><span class="pre">VAR_RNOISE</span></code> extension).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scis</span> <span class="o">=</span> <span class="p">[</span><span class="n">filt</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">filt</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<span class="n">whts</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">filt</span><span class="p">[</span><span class="s1">&#39;var_rnoise&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">filt</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<span class="n">detimg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">scis</span><span class="p">,</span> <span class="n">whts</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">whts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
<span class="n">scis</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># free memory</span>
<span class="n">whts</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">detimg</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="image-segmentation-source-extraction">
<h2>Image Segmentation (Source Extraction)<a class="headerlink" href="#image-segmentation-source-extraction" title="Link to this heading">#</a></h2>
<p>Image segmentation is a process of assigning a label to every pixel in an image, such that pixels with the same label are part of the same source. Detected sources must have a minimum number of connected pixels that are each greater than a specified threshold value in an image.</p>
<p>The threshold level is usually defined as a multiple of the background noise (sigma level) above the background. This can be specified either as a per-pixel threshold image or a single threshold value for the whole image.</p>
<p>The image is often filtered before thresholding to smooth the noise and maximize the detectability of objects with a shape similar to the filter kernel.</p>
<p>Let’s convolve the background-subtracted detection image with a 2D Gaussian kernel with a FWHM of 3 pixels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">kernel_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kernel_fwhm</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">make_2dgaussian_kernel</span><span class="p">(</span><span class="n">kernel_fwhm</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">)</span>
<span class="n">detconv</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">detimg</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">coverage_mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coverage_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">detimg</span><span class="p">)</span>
<span class="n">bkg</span> <span class="o">=</span> <span class="n">Background2D</span><span class="p">(</span><span class="n">detimg</span><span class="p">,</span> <span class="n">box_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">filter_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                   <span class="n">exclude_percentile</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">coverage_mask</span><span class="o">=</span><span class="n">coverage_mask</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">ceers_bkgmask</span><span class="p">,</span>
                   <span class="n">bkg_estimator</span><span class="o">=</span><span class="n">bkg_estimator</span><span class="p">,</span> <span class="n">bkgrms_estimator</span><span class="o">=</span><span class="n">bkgrms_estimator</span><span class="p">)</span>
<span class="n">bkgrms</span> <span class="o">=</span> <span class="n">bkg</span><span class="o">.</span><span class="n">background_rms</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">detconv</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">norm2</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">bkgrms</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bkgrms</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we need to define the detection threshold. In this example, we’ll define a 2D detection threshold image using the background RMS image calculated above. We set the threshold at the 4.0<span class="math notranslate nohighlight">\(\sigma\)</span> (per pixel) noise level (above the background).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold</span> <span class="o">=</span> <span class="n">bkgrms</span> <span class="o">*</span> <span class="mf">4.0</span>
<span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we are ready to detect the sources in the background-subtracted convolved image. Let’s find sources that have at least 25 connected pixels that are each greater than the corresponding threshold level defined above. For this, we use the <a class="reference external" href="https://photutils.readthedocs.io/en/stable/api/photutils.segmentation.detect_sources.html">detect_sources</a> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">detimg</span><span class="p">)</span>
<span class="n">npixels</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">segm</span> <span class="o">=</span> <span class="n">detect_sources</span><span class="p">(</span><span class="n">detconv</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">npixels</span><span class="o">=</span><span class="n">npixels</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
<span class="n">segm</span>
</pre></div>
</div>
</div>
</div>
<p>The result is a segmentation image (<a class="reference external" href="https://photutils.readthedocs.io/en/stable/api/photutils.segmentation.SegmentationImage.html">SegmentationImage</a> object).  The segmentation image is an array with the same size as the science image, in which each detected source is labeled with a unique integer value (&gt;= 1).  Background pixels have a value of 0.  As a simple example, a segmentation map containing two distinct sources (labeled 1 and 2) might look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span>
<span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">0</span>
<span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
</pre></div>
</div>
<p>where all the pixels labeled <code class="docutils literal notranslate"><span class="pre">1</span></code> belong to the first source, all those labeled <code class="docutils literal notranslate"><span class="pre">2</span></code> belong to the second, and all those labeled <code class="docutils literal notranslate"><span class="pre">0</span></code> are background pixels.</p>
<p>Let’s plot the segmentation image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">segm</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the segmentation image next to the science image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># switch to interactive plots</span>
<span class="o">%</span><span class="k">matplotlib</span> widget
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">detconv</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Detection Image&#39;</span><span class="p">)</span>
<span class="n">segm</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Segmentation Image&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">plot_patches</span></code> <code class="docutils literal notranslate"><span class="pre">SegmentationImage</span></code> method to plot the segmentation outlines on the science image.</p>
<p>This is a good way to inspect the source extraction. The source detection parameters (e.g., <code class="docutils literal notranslate"><span class="pre">threshold</span></code>, <code class="docutils literal notranslate"><span class="pre">npixels</span></code>) can be adjusted as needed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">detimg</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">segm</span><span class="o">.</span><span class="n">plot_patches</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">SegmentationImage</span></code> object has attributes that can give various properties of the source segments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">star_label</span> <span class="o">=</span> <span class="n">segm</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">3852</span><span class="p">,</span> <span class="mi">612</span><span class="p">]</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">segm</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">star_label</span><span class="p">)</span>
<span class="n">sobj</span> <span class="o">=</span> <span class="n">segm</span><span class="o">.</span><span class="n">segments</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<span class="n">sobj</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="n">sobj</span><span class="o">.</span><span class="n">bbox</span><span class="p">,</span> <span class="n">sobj</span><span class="o">.</span><span class="n">slices</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sobj</span><span class="o">.</span><span class="n">polygon</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="source-deblending">
<h2>Source deblending<a class="headerlink" href="#source-deblending" title="Link to this heading">#</a></h2>
<p>Comparing the data array with the segmentation image, we see that several detected sources were blended together.  We can deblend them using the <a class="reference external" href="https://photutils.readthedocs.io/en/stable/api/photutils.segmentation.deblend_sources.html">deblend_sources</a> function, which uses a combination of multi-thresholding and <a class="reference external" href="https://en.wikipedia.org/wiki/Watershed_(image_processing)">watershed</a> segmentation.</p>
<p>The deblending can be controlled with the <code class="docutils literal notranslate"><span class="pre">deblend_sources</span></code> keywords:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nlevels</span></code> is the number of multi-thresholding levels to use; larger values give more deblending, but longer runtime</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">contrast</span></code> is the fraction (0 - 1) of the total source flux that a local peak must have to be considered as a separate object</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">contrast</span> <span class="pre">=</span> <span class="pre">1</span></code>: no deblending</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">contrast</span> <span class="pre">=</span> <span class="pre">0</span></code>: max deblending</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code> is the mode used in defining the spacing of the <code class="docutils literal notranslate"><span class="pre">nlevels</span></code> (<code class="docutils literal notranslate"><span class="pre">‘exponential’,</span> <span class="pre">‘linear’,</span> <span class="pre">‘sinh’</span></code>)</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">npixels</span></code> and <code class="docutils literal notranslate"><span class="pre">connectivity</span></code> values should match those used in <code class="docutils literal notranslate"><span class="pre">detect_sources</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">npixels2</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">segm_deblended</span> <span class="o">=</span> <span class="n">deblend_sources</span><span class="p">(</span><span class="n">detconv</span><span class="p">,</span> <span class="n">segm</span><span class="p">,</span> <span class="n">npixels</span><span class="o">=</span><span class="n">npixels2</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">segm</span><span class="o">.</span><span class="n">nlabels</span><span class="p">,</span> <span class="n">segm_deblended</span><span class="o">.</span><span class="n">nlabels</span><span class="p">,</span> <span class="n">segm_deblended</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">segm</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Segmentation Image&#39;</span><span class="p">)</span>
<span class="n">segm_deblended</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Deblended Segmentation Image&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">label</span> <span class="o">=</span> <span class="n">segm</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1597</span><span class="p">,</span> <span class="mi">3877</span><span class="p">]</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">segm</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
<span class="n">slc2</span> <span class="o">=</span> <span class="n">segm</span><span class="o">.</span><span class="n">slices</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">norm3</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">detconv</span><span class="p">[</span><span class="n">slc2</span><span class="p">],</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">98</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">detconv</span><span class="p">[</span><span class="n">slc2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Detection Image&#39;</span><span class="p">)</span>
<span class="n">segm</span><span class="p">[</span><span class="n">slc2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Segmentation Image&#39;</span><span class="p">)</span>
<span class="n">segm_deblended</span><span class="p">[</span><span class="n">slc2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Deblended Segmentation Image&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">detimg</span><span class="p">[</span><span class="n">slc2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm3</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">segm_deblended</span><span class="p">[</span><span class="n">slc2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">child_labels</span> <span class="o">=</span> <span class="n">segm_deblended</span><span class="o">.</span><span class="n">deblended_labels_inverse_map</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
<span class="n">child_labels</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">segm_deblended</span><span class="o">.</span><span class="n">deblended_labels_map</span><span class="p">[</span><span class="n">child_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="modifying-a-segmentation-image">
<h2>Modifying a Segmentation Image<a class="headerlink" href="#modifying-a-segmentation-image" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">SegmentationImage</span></code> object provides several methods that can be used to modify itself (e.g., combining labels, removing labels, removing border segments) prior to measuring source photometry and other source properties, including:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">reassign_labels</span></code>: Reassign one or more label numbers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">relabel_consecutive</span></code>: Reassign the label numbers consecutively, such that there are no missing label numbers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keep_labels</span></code>: Keep only the specified labels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remove_labels</span></code>: Remove one or more labels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remove_border_labels</span></code>: Remove labeled segments near the image border.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remove_masked_labels</span></code>: Remove labeled segments located within a masked region.</p></li>
</ul>
<p>Let’s combine the deblended segments of the bright star.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">star_label</span> <span class="o">=</span> <span class="n">segm</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">3852</span><span class="p">,</span> <span class="mi">612</span><span class="p">]</span>
<span class="n">child_labels</span> <span class="o">=</span> <span class="n">segm_deblended</span><span class="o">.</span><span class="n">deblended_labels_inverse_map</span><span class="p">[</span><span class="n">star_label</span><span class="p">]</span>
<span class="n">child_labels</span>
</pre></div>
</div>
</div>
</div>
<p>But, we’ll exclude the labels which are galaxies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xy_exclude</span> <span class="o">=</span> <span class="p">((</span><span class="mi">462</span><span class="p">,</span> <span class="mi">4059</span><span class="p">),</span> <span class="p">(</span><span class="mi">495</span><span class="p">,</span> <span class="mi">3770</span><span class="p">),</span> <span class="p">(</span><span class="mi">807</span><span class="p">,</span> <span class="mi">4100</span><span class="p">),</span> <span class="p">(</span><span class="mi">1110</span><span class="p">,</span> <span class="mi">4270</span><span class="p">))</span>
<span class="n">x_exclude</span><span class="p">,</span> <span class="n">y_exclude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">xy_exclude</span><span class="p">)</span>
<span class="n">exclude_labels</span> <span class="o">=</span> <span class="n">segm_deblended</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">y_exclude</span><span class="p">,</span> <span class="n">x_exclude</span><span class="p">]</span>
<span class="n">exclude_labels</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keep_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">child_labels</span><span class="p">,</span> <span class="n">exclude_labels</span><span class="p">)</span>
<span class="n">keep_labels</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">segm_deblended</span><span class="o">.</span><span class="n">reassign_labels</span><span class="p">(</span><span class="n">keep_labels</span><span class="p">,</span> <span class="n">keep_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">segm</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Segmentation Image&#39;</span><span class="p">)</span>
<span class="n">segm_deblended</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Deblended Segmentation Image&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s use the <code class="docutils literal notranslate"><span class="pre">remove_label</span></code> method to remove the bright star from the segmentation image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">segm_deblended</span><span class="o">.</span><span class="n">remove_label</span><span class="p">(</span><span class="n">keep_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">segm_deblended</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>When we combined and then removed segments, our segment labels are no longer consecutive.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">segm_deblended</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">segm_deblended</span><span class="o">.</span><span class="n">is_consecutive</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">segm_deblended</span><span class="o">.</span><span class="n">missing_labels</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">segm_deblended</span><span class="o">.</span><span class="n">relabel_consecutive</span><span class="p">()</span>
<span class="n">segm_deblended</span><span class="o">.</span><span class="n">is_consecutive</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">segm_deblended</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sourcefinder-class">
<h2>SourceFinder class<a class="headerlink" href="#sourcefinder-class" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">SourceFinder</span></code> class is a convenience class that combines the functionality of <code class="docutils literal notranslate"><span class="pre">detect_sources</span></code> and <code class="docutils literal notranslate"><span class="pre">deblend_sources</span></code>. After defining the <code class="docutils literal notranslate"><span class="pre">SourceFinder</span></code> object with the desired detection and deblending parameters, you call it with the background-subtracted (convolved) image and threshold.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># finder = SourceFinder(npixels=(npixels, npixels2), deblend=True, progress_bar=True)</span>
<span class="c1"># segment_map = finder(detconv, threshold, mask=mask)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="source-catalog-photometry-centroids-and-shape-properties">
<h2>Source Catalog: Photometry, Centroids, and Shape Properties<a class="headerlink" href="#source-catalog-photometry-centroids-and-shape-properties" title="Link to this heading">#</a></h2>
<p>The <a class="reference external" href="https://photutils.readthedocs.io/en/stable/api/photutils.segmentation.SourceCatalog.html">SourceCatalog</a> class is used to measure the photometry, centroids, and shape/morphological properties of sources defined in a segmentation image. In its most basic form, it takes as input the (background-subtracted) image and the segmentation image. Usually the convolved image is also input, from which the source centroids and shape/morphological properties are measured (if not input, the unconvolved image is used instead).</p>
<p>First, we create a catalog from the detection image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">det_cat</span> <span class="o">=</span> <span class="n">SourceCatalog</span><span class="p">(</span><span class="n">detimg</span><span class="p">,</span> <span class="n">segm_deblended</span><span class="p">,</span> <span class="n">convolved_data</span><span class="o">=</span><span class="n">detconv</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">f356w</span><span class="p">[</span><span class="s1">&#39;wcs&#39;</span><span class="p">])</span>
<span class="n">det_cat</span>
</pre></div>
</div>
</div>
</div>
<p>Our <code class="docutils literal notranslate"><span class="pre">det_cat</span></code> variable is a <code class="docutils literal notranslate"><span class="pre">SourceCatalog</span></code> object for the detection image.</p>
<p>The properties of each source can be accessed using <code class="docutils literal notranslate"><span class="pre">SourceCatalog</span></code> attributes, or they can be output to an Astropy <code class="docutils literal notranslate"><span class="pre">QTable</span></code> using the <code class="docutils literal notranslate"><span class="pre">to_table</span></code> method.</p>
<p>Please see the <a class="reference external" href="https://photutils.readthedocs.io/en/stable/api/photutils.segmentation.SourceCatalog.html">SourceCatalog documentation</a> for a complete list of the available source properties.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">to_table</span></code> method is used to create a table of source measurements. The output is an Astropy <code class="docutils literal notranslate"><span class="pre">QTable</span></code>.</p>
<p>Each row in the table represents a source. The columns represent the calculated source properties. The <code class="docutils literal notranslate"><span class="pre">label</span></code> column corresponds to the label value in the input segmentation image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">det_tbl</span> <span class="o">=</span> <span class="n">det_cat</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span>
<span class="n">det_tbl</span>
</pre></div>
</div>
</div>
</div>
<p>The output columns can be customized using the optional <code class="docutils literal notranslate"><span class="pre">columns</span></code> keyword.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;xcentroid&#39;</span><span class="p">,</span> <span class="s1">&#39;ycentroid&#39;</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="s1">&#39;segment_flux&#39;</span><span class="p">,</span> <span class="s1">&#39;kron_flux&#39;</span><span class="p">)</span>
<span class="n">det_tbl2</span> <span class="o">=</span> <span class="n">det_cat</span><span class="o">.</span><span class="n">to_table</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">det_tbl2</span>
</pre></div>
</div>
</div>
</div>
<p>Here, we access a few of the source properties as attributes of the <code class="docutils literal notranslate"><span class="pre">SourceCatalog</span></code> object. These get returned as NumPy arrays or Astropy objects (e.g., <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code>, <code class="docutils literal notranslate"><span class="pre">Quantity</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">det_cat</span><span class="o">.</span><span class="n">xcentroid</span><span class="p">,</span> <span class="n">det_cat</span><span class="o">.</span><span class="n">sky_centroid</span><span class="p">,</span> <span class="n">det_cat</span><span class="o">.</span><span class="n">segment_flux</span><span class="p">,</span> <span class="n">det_cat</span><span class="o">.</span><span class="n">orientation</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="multiband-catalog">
<h2>Multiband Catalog<a class="headerlink" href="#multiband-catalog" title="Link to this heading">#</a></h2>
<p>Now let’s perform the photometry on each of the filter images.  We pass in the science and (total) error array for each band, plus the segmentation image and the detection catalog <code class="docutils literal notranslate"><span class="pre">SourceCatalog</span></code> object created above. We need to input the detection catalog to ensure that the aperture centroids (and shapes for Kron apertures) are the same for all the bands.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f115w_cat</span> <span class="o">=</span> <span class="n">SourceCatalog</span><span class="p">(</span><span class="n">f115w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">],</span> <span class="n">segm_deblended</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">f115w</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">],</span> <span class="n">detection_cat</span><span class="o">=</span><span class="n">det_cat</span><span class="p">)</span>
<span class="n">f200w_cat</span> <span class="o">=</span> <span class="n">SourceCatalog</span><span class="p">(</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">],</span> <span class="n">segm_deblended</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">],</span> <span class="n">detection_cat</span><span class="o">=</span><span class="n">det_cat</span><span class="p">)</span>
<span class="n">f356w_cat</span> <span class="o">=</span> <span class="n">SourceCatalog</span><span class="p">(</span><span class="n">f356w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">],</span> <span class="n">segm_deblended</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">f356w</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">],</span> <span class="n">detection_cat</span><span class="o">=</span><span class="n">det_cat</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">SourceCatalog</span></code> class computes only “segment” (isophotal) photometry and Kron (elliptical aperture) photometry.
We can also compute circular aperture photometry at various radii using the <code class="docutils literal notranslate"><span class="pre">circular_photometry</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f115w_cat</span><span class="o">.</span><span class="n">circular_photometry</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;circ_rad5&#39;</span><span class="p">)</span>
<span class="n">f115w_cat</span><span class="o">.</span><span class="n">circular_photometry</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;circ_rad10&#39;</span><span class="p">)</span>
<span class="n">f200w_cat</span><span class="o">.</span><span class="n">circular_photometry</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;circ_rad5&#39;</span><span class="p">)</span>
<span class="n">f200w_cat</span><span class="o">.</span><span class="n">circular_photometry</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;circ_rad10&#39;</span><span class="p">)</span>
<span class="n">f356w_cat</span><span class="o">.</span><span class="n">circular_photometry</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;circ_rad5&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">f356w_cat</span><span class="o">.</span><span class="n">circular_photometry</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;circ_rad10&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;segment_flux&#39;</span><span class="p">,</span> <span class="s1">&#39;segment_fluxerr&#39;</span><span class="p">,</span> <span class="s1">&#39;kron_flux&#39;</span><span class="p">,</span> <span class="s1">&#39;kron_fluxerr&#39;</span><span class="p">,</span> 
           <span class="s1">&#39;circ_rad5_flux&#39;</span><span class="p">,</span> <span class="s1">&#39;circ_rad5_fluxerr&#39;</span><span class="p">,</span> <span class="s1">&#39;circ_rad10_flux&#39;</span><span class="p">,</span> <span class="s1">&#39;circ_rad10_fluxerr&#39;</span><span class="p">]</span>
<span class="n">f115w_tbl</span> <span class="o">=</span> <span class="n">f115w_cat</span><span class="o">.</span><span class="n">to_table</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">f200w_tbl</span> <span class="o">=</span> <span class="n">f200w_cat</span><span class="o">.</span><span class="n">to_table</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">f356w_tbl</span> <span class="o">=</span> <span class="n">f356w_cat</span><span class="o">.</span><span class="n">to_table</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add_magnitudes</span><span class="p">(</span><span class="n">tbl</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tbl</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;flux&#39;</span><span class="p">):</span>
            <span class="n">fluxerr_col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;flux&#39;</span><span class="p">,</span> <span class="s1">&#39;fluxerr&#39;</span><span class="p">)</span>
            <span class="n">flux</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="n">fluxerr</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[</span><span class="n">fluxerr_col</span><span class="p">]</span>

            <span class="n">mag</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">flux</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mf">23.9</span>
            <span class="n">magerr</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">flux</span> <span class="o">/</span> <span class="n">fluxerr</span><span class="p">))</span>

            <span class="c1"># set negative flux to the 2-sigma upper limit</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">flux</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span>
            <span class="n">mag</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">fluxerr</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mf">23.9</span>
            <span class="n">magerr</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="n">magcol</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;flux&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">)</span>
            <span class="n">magerrcol</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">magcol</span><span class="si">}</span><span class="s1">err&#39;</span>
            <span class="n">tbl</span><span class="p">[</span><span class="n">magcol</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mag</span>
            <span class="n">tbl</span><span class="p">[</span><span class="n">magerrcol</span><span class="p">]</span> <span class="o">=</span> <span class="n">magerr</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mag</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="n">f115w_tbl</span> <span class="o">=</span> <span class="n">add_magnitudes</span><span class="p">(</span><span class="n">f115w_tbl</span><span class="p">)</span>
<span class="n">f200w_tbl</span> <span class="o">=</span> <span class="n">add_magnitudes</span><span class="p">(</span><span class="n">f200w_tbl</span><span class="p">)</span>
<span class="n">f356w_tbl</span> <span class="o">=</span> <span class="n">add_magnitudes</span><span class="p">(</span><span class="n">f356w_tbl</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">prefix_flux_columns</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tbl</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span>
            <span class="n">tbl</span><span class="o">.</span><span class="n">rename_column</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="n">f115w_tbl</span> <span class="o">=</span> <span class="n">prefix_flux_columns</span><span class="p">(</span><span class="n">f115w_tbl</span><span class="p">,</span> <span class="s1">&#39;f115w&#39;</span><span class="p">)</span>
<span class="n">f200w_tbl</span> <span class="o">=</span> <span class="n">prefix_flux_columns</span><span class="p">(</span><span class="n">f200w_tbl</span><span class="p">,</span> <span class="s1">&#39;f200w&#39;</span><span class="p">)</span>
<span class="n">f356w_tbl</span> <span class="o">=</span> <span class="n">prefix_flux_columns</span><span class="p">(</span><span class="n">f356w_tbl</span><span class="p">,</span> <span class="s1">&#39;f356w&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f115w_tbl</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s combine the detection and filter tables into one main table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">det_columns</span> <span class="o">=</span> <span class="n">det_tbl</span><span class="o">.</span><span class="n">colnames</span><span class="p">[:</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span>  <span class="c1"># trim some columns</span>
<span class="n">main_tbl</span> <span class="o">=</span> <span class="n">det_cat</span><span class="o">.</span><span class="n">to_table</span><span class="p">(</span><span class="n">det_columns</span><span class="p">)</span>
<span class="n">main_tbl</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mult_tbl</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">main_tbl</span><span class="p">,</span> <span class="n">f115w_tbl</span><span class="p">,</span> <span class="n">f200w_tbl</span><span class="p">,</span> <span class="n">f356w_tbl</span><span class="p">),</span> <span class="n">metadata_conflicts</span><span class="o">=</span><span class="s1">&#39;silent&#39;</span><span class="p">)</span>
<span class="n">mult_tbl</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">mult_tbl</span><span class="o">.</span><span class="n">colnames</span><span class="p">),</span> <span class="n">mult_tbl</span><span class="o">.</span><span class="n">colnames</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s create a copy of our source table where we included the largest 500 sources.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_tbl</span> <span class="o">=</span> <span class="n">mult_tbl</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tmp_tbl</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># sort by decreasing area</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_tbl</span> <span class="o">=</span> <span class="n">tmp_tbl</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">500</span><span class="p">]</span>  <span class="c1"># select first 500 sources</span>
<span class="n">tmp_tbl</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s save our source catalog table to an <a class="reference external" href="https://docs.astropy.org/en/stable/io/ascii/ecsv.html">Astropy ECSV</a> file. The ECSV format is the recommended way to store Table data in a human-readable ASCII file.</p>
<p>We’ll use this file later in the <code class="docutils literal notranslate"><span class="pre">Imviz</span></code> tutorial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_tbl</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;photutils_cat.ecsv&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="photometry-types">
<h2>Photometry types<a class="headerlink" href="#photometry-types" title="Link to this heading">#</a></h2>
<section id="segment-fluxes-aka-isophotal-fluxes">
<h3>Segment fluxes (aka “Isophotal Fluxes”)<a class="headerlink" href="#segment-fluxes-aka-isophotal-fluxes" title="Link to this heading">#</a></h3>
<p>The segment fluxes are simply the sources fluxes measured using the pixels within the source segments.</p>
<p>This is sometimes referred to as “isophotal flux” because source segments were defined as the pixels above a threshold flux level (i.e. isophote).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">label</span> <span class="o">=</span> <span class="n">segm_deblended</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1130</span><span class="p">,</span> <span class="mi">3780</span><span class="p">]</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">segm_deblended</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<span class="n">segm_deblended</span><span class="o">.</span><span class="n">polygons</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">norm3</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">f200w_cat</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">98</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f200w_cat</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F200W Data&#39;</span><span class="p">)</span>
<span class="n">norm3</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">f200w_cat</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">98</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f200w_cat</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F200W Error&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f200w_cat</span><span class="o">.</span><span class="n">segment_ma</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Segment (detection image)&#39;</span><span class="p">)</span>
<span class="n">norm3</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">det_cat</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">det_cat</span><span class="o">.</span><span class="n">data_ma</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm3</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Detection Image)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">norm3</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">f200w_cat</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">98</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f200w_cat</span><span class="o">.</span><span class="n">data_ma</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F200W Data&#39;</span><span class="p">)</span>
<span class="n">norm3</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">f200w_cat</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">98</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f200w_cat</span><span class="o">.</span><span class="n">error_ma</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F200W Error&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f200w_cat</span><span class="o">.</span><span class="n">segment_ma</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Segment (detection image)&#39;</span><span class="p">)</span>
<span class="n">norm3</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">det_cat</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">det_cat</span><span class="o">.</span><span class="n">data_ma</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm3</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Detection Image)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h3>Aperture Photometry<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>Aperture fluxes are measured in a circular aperture.  We can use the <code class="docutils literal notranslate"><span class="pre">plot_circular_apertures</span></code> method to plot them.
Recall we computed aperture fluxes above with r=5 and r=10 pixels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">],</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">det_cat</span><span class="o">.</span><span class="n">plot_circular_apertures</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="kron-photometry">
<h3>Kron Photometry<a class="headerlink" href="#kron-photometry" title="Link to this heading">#</a></h3>
<p>Kron photometry is measured in elliptical apertures. The shape of the elliptical apertures are different for each source and defined from the object’s shape.</p>
<p>The object’s shape is based on calculating <a class="reference external" href="https://en.wikipedia.org/wiki/Image_moment">image moments</a> from the object’s profile.</p>
<p>The size of the aperture calculated from the Kron radius (measured from a first moment of the object’s profile) times a scale factor (which can be specified). It is defined as the radius within which a fixed fraction (around 90%) of the total light emitted by the object is enclosed.</p>
<p>Let’s use the <code class="docutils literal notranslate"><span class="pre">plot_kron_apertures</span></code> method to plot the Kron apertures.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">det_cat</span><span class="o">.</span><span class="n">plot_kron_apertures</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s export the Kron apertures for the largest 500 sources. We’ll save the apertures to a DS9 region file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idx</span> <span class="o">=</span> <span class="n">segm_deblended</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">tmp_tbl</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
<span class="n">objs</span> <span class="o">=</span> <span class="n">det_cat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<span class="n">objs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f200w</span><span class="p">[</span><span class="s1">&#39;sci_bksub&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">objs</span><span class="o">.</span><span class="n">plot_kron_apertures</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here, we convert the Kron apertures to <a class="reference external" href="https://astropy-regions.readthedocs.io/en/stable/">Astropy Region</a> objects, which can be serialized to DS9 format.</p>
<p>We’ll use this file later in the <code class="docutils literal notranslate"><span class="pre">Imviz</span></code> tutorial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regions</span> <span class="o">=</span> <span class="n">Regions</span><span class="p">([</span><span class="n">aperture_to_region</span><span class="p">(</span><span class="n">aper</span><span class="o">.</span><span class="n">to_sky</span><span class="p">(</span><span class="n">wcs</span><span class="o">=</span><span class="n">f356w</span><span class="p">[</span><span class="s1">&#39;wcs&#39;</span><span class="p">]))</span> <span class="k">for</span> <span class="n">aper</span> <span class="ow">in</span> <span class="n">objs</span><span class="o">.</span><span class="n">kron_aperture</span><span class="p">])</span>
<span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># show the first 3 regions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regions</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;kron_apertures.reg&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="data-exploration">
<h2>Data Exploration<a class="headerlink" href="#data-exploration" title="Link to this heading">#</a></h2>
<p>As an example, let’s look for Lyman-break F115W dropout galaxies in our multiband catalog.</p>
<p>We’ll use a color-color selection criteria, where the first color is F115W - F200W (the dropout color) and the second is F200W - F356W.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f115w_f200w</span> <span class="o">=</span> <span class="n">mult_tbl</span><span class="p">[</span><span class="s1">&#39;f115w_kron_mag&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mult_tbl</span><span class="p">[</span><span class="s1">&#39;f200w_kron_mag&#39;</span><span class="p">]</span>
<span class="n">f200w_f356w</span> <span class="o">=</span> <span class="n">mult_tbl</span><span class="p">[</span><span class="s1">&#39;f200w_kron_mag&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mult_tbl</span><span class="p">[</span><span class="s1">&#39;f356w_kron_mag&#39;</span><span class="p">]</span>

<span class="n">f115w_segm_snr</span> <span class="o">=</span> <span class="n">mult_tbl</span><span class="p">[</span><span class="s1">&#39;f115w_segment_flux&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mult_tbl</span><span class="p">[</span><span class="s1">&#39;f115w_segment_fluxerr&#39;</span><span class="p">]</span>
<span class="n">f115w_snr</span> <span class="o">=</span> <span class="n">mult_tbl</span><span class="p">[</span><span class="s1">&#39;f115w_kron_flux&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mult_tbl</span><span class="p">[</span><span class="s1">&#39;f115w_kron_fluxerr&#39;</span><span class="p">]</span>
<span class="n">f200w_snr</span> <span class="o">=</span> <span class="n">mult_tbl</span><span class="p">[</span><span class="s1">&#39;f200w_kron_flux&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mult_tbl</span><span class="p">[</span><span class="s1">&#39;f200w_kron_fluxerr&#39;</span><span class="p">]</span>
<span class="n">f356w_snr</span> <span class="o">=</span> <span class="n">mult_tbl</span><span class="p">[</span><span class="s1">&#39;f356w_kron_flux&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mult_tbl</span><span class="p">[</span><span class="s1">&#39;f356w_kron_fluxerr&#39;</span><span class="p">]</span>

<span class="n">col_t1</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">col_t2</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">f115w_f200w</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="n">col_t1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">f200w_f356w</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">col_t2</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">f115w_segm_snr</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">f115w_snr</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">f200w_snr</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">f356w_snr</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">))</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">f200w_f356w</span><span class="p">,</span> <span class="n">f115w_f200w</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">f200w_f356w</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">f115w_f200w</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;F200W – F356W&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;F115W – F200W&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">col_t2</span><span class="p">),</span> <span class="p">(</span><span class="n">col_t1</span><span class="p">,</span> <span class="n">col_t1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">col_t2</span><span class="p">,</span> <span class="n">col_t2</span><span class="p">),</span> <span class="p">(</span><span class="n">col_t1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Color-color selection&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hiz_tbl</span> <span class="o">=</span> <span class="n">mult_tbl</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">hiz_tbl</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">hiz_tbl</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">hiz_tbl</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">segm_deblended</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="n">cimg1</span> <span class="o">=</span> <span class="n">f115w_cat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">make_cutouts</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">cimg2</span> <span class="o">=</span> <span class="n">f200w_cat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">make_cutouts</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">cimg3</span> <span class="o">=</span> <span class="n">f356w_cat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">make_cutouts</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">cimg4</span> <span class="o">=</span> <span class="n">det_cat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">make_cutouts</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">cimg5</span> <span class="o">=</span> <span class="n">CutoutImage</span><span class="p">(</span><span class="n">segm_deblended</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">det_cat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">ycentroid</span><span class="p">,</span> <span class="n">det_cat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">xcentroid</span><span class="p">),</span> <span class="n">shape</span><span class="p">)</span>
    
    <span class="n">snorm</span> <span class="o">=</span> <span class="n">SimpleNorm</span><span class="p">(</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">snorm</span><span class="p">(</span><span class="n">cimg4</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cimg1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">idstr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ID = </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">idstr</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F115W&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cimg2</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F200W&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cimg3</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F356W&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cimg4</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Detection&#39;</span><span class="p">)</span>
    <span class="n">det_cat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot_kron_apertures</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="n">cimg4</span><span class="o">.</span><span class="n">xyorigin</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cimg5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">segm_deblended</span><span class="o">.</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Segment&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The best candidate shown above was reported by the CEERS team (<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2022ApJ...940L..55F/abstract">Finkelstein et al. 2022</a>) as a high-redshift galaxy candidate called <a class="reference external" href="https://news.utexas.edu/2023/08/15/astronomers-confirm-maisies-galaxy-is-among-earliest-ever-observed/">“Maisie’s Galaxy”</a> with a photometric redshift of z = 11.8.</p>
<p>The CEERS team later obtain a NIRSpec spectrum of Maisie’s Galaxy (see <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2023Natur.622..707A/abstract">Arrabal Haro et al. 2023</a>) and measured a spectroscopic redshift of z = 11.416.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># label = 616  # on linux</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">segm_deblended</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1876</span><span class="p">,</span> <span class="mi">401</span><span class="p">]</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">hiz_tbl</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">label</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">hiz_tbl</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<span class="n">obj</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fluxes</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">((</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;f115w_kron_flux&#39;</span><span class="p">],</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;f200w_kron_flux&#39;</span><span class="p">],</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;f356w_kron_flux&#39;</span><span class="p">]))</span>
<span class="n">fluxes</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">nJy</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># measured fluxes from Finkelstein et al. 2022</span>
<span class="n">ceers_fluxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="o">-</span><span class="mf">7.52</span><span class="p">,</span> <span class="mf">45.11</span><span class="p">,</span> <span class="mf">26.29</span><span class="p">))</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">nJy</span>
<span class="n">ceers_fluxes</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fluxes</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ABmag</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ceers_fluxes</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ABmag</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" />
</a>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/cross_instrument/photometry_extragalactic"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Photometry of a JWST/NIRCam extragalactic field with Photutils</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tutorial-overview">Tutorial Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outline">Outline:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">Import packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-datasets">Load Datasets</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-overview">Data Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-units">Data Units</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-and-display-the-data">Load and Display the Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background-subtraction">Background Subtraction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d-background-estimation">2D Background Estimation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#source-mask">Source Mask</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#background2d">Background2D</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aperture-photometry">Aperture Photometry</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-an-aperture-object">Define an Aperture Object</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aperture-photometry-function">aperture_photometry function</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-positions-and-sizes">Multiple positions and sizes</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aperturestats-class">ApertureStats class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sky-based-apertures">Sky-based apertures</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-multiband-segmentation-based-catalog">Creating a multiband segmentation-based catalog</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-detection-image">Creating a Detection Image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#image-segmentation-source-extraction">Image Segmentation (Source Extraction)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#source-deblending">Source deblending</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modifying-a-segmentation-image">Modifying a Segmentation Image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sourcefinder-class">SourceFinder class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#source-catalog-photometry-centroids-and-shape-properties">Source Catalog: Photometry, Centroids, and Shape Properties</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiband-catalog">Multiband Catalog</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#photometry-types">Photometry types</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#segment-fluxes-aka-isophotal-fluxes">Segment fluxes (aka “Isophotal Fluxes”)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Aperture Photometry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kron-photometry">Kron Photometry</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-exploration">Data Exploration</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>